<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.centit.mallserver.dao.ShoppingSpecificationDao">
    <!--    &lt;!&ndash; 通用查询映射结果 &ndash;&gt;-->
    <!--    <resultMap id="BaseResultMap" type="com.centit.mallserver.po.ShoppingSpecificationPo">-->
    <!--        <id column="id" property="specId"/>-->
    <!--        <result column="name" property="specName"/>-->
    <!--        <collection property="propertys" ofType="com.centit.mallserver.po.ShoppingSpecPropertyPo" javaType="List"-->
    <!--                    select="selectPropertysBySpecId" column="id"/>-->
    <!--    </resultMap>-->

    <!--    <resultMap id="PropertyMap" type="com.centit.mallserver.po.ShoppingSpecPropertyPo">-->
    <!--        <id column="id" property="propertyId"/>-->
    <!--        <result column="p_name" property="propertyValue"/>-->
    <!--        <result column="spec_id" property="specId"/>-->
    <!--    </resultMap>-->

    <resultMap id="BaseResultMapWithProperties" type="com.centit.mallserver.po.ShoppingSpecificationPo">
        <id column="id" property="specId"/>
        <result column="name" property="specName"/>
        <collection property="propertys" ofType="com.centit.mallserver.po.ShoppingSpecPropertyPo" javaType="List">
            <id column="propertyId" property="propertyId"/>
            <result column="propertyValue" property="propertyValue"/>
            <result column="spec_id" property="specId"/>
        </collection>
    </resultMap>

    <!--  查询列表 -->
    <select id="queryList" resultMap="BaseResultMapWithProperties" parameterType="java.lang.String">
        select t.id, t.name,
        t2.id propertyId, t2.value as propertyValue, t2.spec_id
        FROM shopping_goodsspecification t
        LEFT JOIN shopping_goodsspecproperty t2 ON t.id = t2.spec_id
        JOIN shopping_goods_spec t3 ON t2.id = t3.spec_id
        <where>
            <![CDATA[
            t3.goods_id = #{goodsId ,jdbcType=VARCHAR }
            ]]>
            and t.deleteStatus='0'
        </where>
        order by t.sequence asc
    </select>

    <select id="selectPropertysValue" parameterType="list" resultType="java.lang.String">
        SELECT GROUP_CONCAT(t1.value SEPARATOR ';')
        FROM shopping_goodsspecproperty t1 left join shopping_goodsspecification sg on t1.spec_id = sg.id
        WHERE t1.id in
        <foreach item="id" index="index" collection="ids" open="(" separator="," close=")">
            #{id}
        </foreach>
        order by sg.sequence
    </select>
</mapper>

